<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <title>LocalStorage Search & Delete Tool</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    input, button, select { padding: 6px; margin: 4px 6px 8px 0; font-size: 14px; }
    .result { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 8px; background:#fafafa; }
    .key { font-weight: 700; }
    pre { white-space: pre-wrap; word-break: break-word; background: #f6f6f6; padding: 8px; border-radius: 6px; }
    .meta { font-size: 12px; color: #666; }
    .small { font-size: 12px; padding: 4px 8px; }
  </style>
</head>
<body>
  <h2>LocalStorage Search & Delete Tool</h2>
  <div>
    <input id="query" placeholder="Search query" style="width:60%" />
    <button id="searchBtn">Search</button>
    <button id="showAll" class="small">Show all</button>
  </div>
  <div id="results"></div>

<script>
let password = prompt('Enter your Password')
  if(password === '565'){
  document.getElementById("showAll").style.display = "block"
  }else{
document.getElementById("showAll").style.display = "none"
}
function tryParseJSON(value){
  try { return JSON.parse(value); } catch(e) { return null; }
}

/* -------- Deletion helpers -------- */
function deleteLocalStorageKey(key) {
  if (!confirm(`Delete entire key "${key}"?`)) return;
  localStorage.removeItem(key);
  refreshResults();
}

function deleteJsonArrayItemByIndex(key, index) {
  const raw = localStorage.getItem(key);
  if (!raw) return;
  let arr = [];
  try { arr = JSON.parse(raw); } catch(e){ return; }
  if (!Array.isArray(arr)) return;
  if (index < 0 || index >= arr.length) return;
  if (!confirm(`Delete item #${index} from "${key}"?`)) return;
  arr.splice(index,1);
  localStorage.setItem(key, JSON.stringify(arr));
  refreshResults();
}

function deleteJsonArrayItemsByMatch(key, matchObj) {
  const raw = localStorage.getItem(key);
  if (!raw) return;
  let arr = [];
  try { arr = JSON.parse(raw); } catch(e){ return; }
  if (!Array.isArray(arr)) return;
  const newArr = arr.filter(it => {
    if (typeof it !== 'object') return true;
    for (const p in matchObj) {
      if (String(it[p] ?? '') !== String(matchObj[p])) return true;
    }
    return false; // delete match
  });
  if (newArr.length === arr.length) { alert('No matches found'); return; }
  if (!confirm(`Delete ${arr.length - newArr.length} matching item(s) from "${key}"?`)) return;
  localStorage.setItem(key, JSON.stringify(newArr));
  refreshResults();
}

/* -------- Search -------- */
function searchLocalStorage(q) {
  const results = [];
  for (let i=0;i<localStorage.length;i++) {
    const key = localStorage.key(i);
    const raw = localStorage.getItem(key);
    if (!q || key.toLowerCase().includes(q.toLowerCase()) || (raw && raw.toLowerCase().includes(q.toLowerCase()))) {
      const parsed = tryParseJSON(raw);
      results.push({key, raw, parsed});
    }
  }
  return results;
}

/* -------- Render -------- */
const resultsDiv = document.getElementById('results');

function renderResults(arr) {
  resultsDiv.innerHTML = '';
  if (!arr.length) { resultsDiv.innerHTML = '<p class="meta">No matches</p>'; return; }
  arr.forEach(entry => {
    const el = document.createElement('div'); el.className='result';
    el.innerHTML = `
      <div class="key">${entry.key}</div>
      <button class="small" onclick="deleteLocalStorageKey('${entry.key}')">Delete key</button>
      <div style="margin-top:6px"><strong>Raw value:</strong><pre>${escapeHtml(entry.raw)}</pre></div>
    `;
    // if array -> per-item delete
    if (Array.isArray(entry.parsed)) {
      const list = document.createElement('div');
      list.style.marginTop = '6px';
      list.innerHTML = '<strong>Array items:</strong>';
      entry.parsed.slice(0,15).forEach((it, idx) => {
        const d = document.createElement('div');
        d.style.border = '1px solid #ddd'; d.style.padding='4px'; d.style.margin='4px'; d.style.borderRadius='6px';
        d.textContent = `#${idx}: ${JSON.stringify(it).slice(0,50)}`;
        const b = document.createElement('button');
        b.textContent = 'Del'; b.className='small';
        b.onclick = () => deleteJsonArrayItemByIndex(entry.key, idx);
        d.appendChild(b);
        list.appendChild(d);
      });
      // quick delete by field=value
      const quick = document.createElement('div');
      quick.innerHTML = `
        <input placeholder="field" id="fld-${entry.key}" class="small">
        <input placeholder="value" id="val-${entry.key}" class="small">
        <button class="small" id="go-${entry.key}">Delete matches</button>
      `;
      list.appendChild(quick);
      setTimeout(()=> {
        const btn = document.getElementById(`go-${entry.key}`);
        btn.onclick = () => {
          const f = document.getElementById(`fld-${entry.key}`).value.trim();
          const v = document.getElementById(`val-${entry.key}`).value.trim();
          if (!f||!v) { alert('Enter both'); return; }
          const obj={}; obj[f]=v;
          deleteJsonArrayItemsByMatch(entry.key,obj);
        };
      },0);
      el.appendChild(list);
    }
    resultsDiv.appendChild(el);
  });
}

function escapeHtml(s) {
  return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
}

/* -------- UI events -------- */
document.getElementById('searchBtn').onclick = () => {
  const q = document.getElementById('query').value;
  const found = searchLocalStorage(q);
  renderResults(found);
};
document.getElementById('showAll').onclick = () => {
  renderResults(searchLocalStorage(''));
};

function refreshResults(){
  const q = document.getElementById('query').value;
  renderResults(searchLocalStorage(q));
}
</script>
</body>
</html>