<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Homework by Date (LocalStorage)</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 24px; background:#f7f8fb; color:#111; display:flex; flex-direction:column; gap:24px; }
    .date-card { background:white; border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(20,20,40,0.06); max-width:760px; margin:auto; width:100%; }
    .date-title { font-size:18px; font-weight:700; margin-bottom:12px; border-bottom:1px solid #eee; padding-bottom:6px; }
    ul.tasks { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px; }
    li.task { display:flex; align-items:center; gap:12px; padding:10px; border-radius:8px; transition:all .18s ease; }
    li.task:not(.expired):hover { transform:translateY(-2px); box-shadow:0 6px 18px rgba(20,20,40,0.04); }
    .meta { display:flex; flex-direction:column; line-height:1.3; }
    .title { font-weight:600; }
    .deadline { font-size:12px; color:#666; }
    .check-area { width:40px; display:flex; align-items:center; justify-content:center; }
    input[type="checkbox"] { width:18px; height:18px; }
    /* expired style */
    li.task.expired { opacity:0.7; background: linear-gradient(90deg, rgba(255,230,230,0.6), rgba(255,245,245,0.4)); border:1px solid rgba(255,200,200,0.6); }
    li.task.expired .title { text-decoration: line-through; color:#a33; }
    .x-mark { font-size:20px; font-weight:700; color:#c33; transform:rotate(-12deg); }
    li.task.expired .checkbox { display:none; }
  </style>
</head>
<body id="app">

<script>
const THRESHOLD_MS = 12 * 60 * 60 * 1000;

// Example seeding (अगर LocalStorage खाली हो तो):
if (!localStorage.getItem("homeworks")) {
  const sample = {
    "2025-09-09": [
      {"title":"Math: Chapter 5 Practice","deadline":"2025-09-09T18:00:00+05:30","checked":false},
      {"title":"English Essay","deadline":"2025-09-09T21:00:00+05:30","checked":true}
    ],
    "2025-09-10": [
      {"title":"Science Worksheet","deadline":"2025-09-10T20:00:00+05:30","checked":false}
    ]
  };
  localStorage.setItem("homeworks", JSON.stringify(sample));
}

// Render cards from LocalStorage
function renderHomeworks() {
  const app = document.getElementById("app");
  app.innerHTML = ""; // clear

  const data = JSON.parse(localStorage.getItem("homeworks")) || {};
  const now = new Date();

  Object.keys(data).sort().forEach(dateKey => {
    const card = document.createElement("div");
    card.className = "date-card";
    card.innerHTML = `<div class="date-title">${dateKey}</div>`;
    const ul = document.createElement("ul");
    ul.className = "tasks";

    data[dateKey].forEach((task, idx) => {
      const li = document.createElement("li");
      li.className = "task";
      li.setAttribute("data-deadline", task.deadline);

      const cbArea = document.createElement("div");
      cbArea.className = "check-area checkbox";
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = task.checked;
      cbArea.appendChild(checkbox);

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML = `<div class="title">${task.title}</div>
                        <div class="deadline">Due: ${new Date(task.deadline).toLocaleString()}</div>`;

      const xArea = document.createElement("div");
      xArea.className = "check-area x-area";
      xArea.style.display = "none";
      xArea.innerHTML = `<span class="x-mark">✗</span>`;

      li.appendChild(cbArea);
      li.appendChild(meta);
      li.appendChild(xArea);

      ul.appendChild(li);

      // checkbox event save
      checkbox.addEventListener("change", () => {
        task.checked = checkbox.checked;
        localStorage.setItem("homeworks", JSON.stringify(data));
        refreshTask(li, task);
      });

      refreshTask(li, task);
    });

    card.appendChild(ul);
    app.appendChild(card);
  });
}

// Apply expiry rule on one task
function refreshTask(li, task) {
  const now = new Date();
  const deadline = new Date(task.deadline);
  const diff = now - deadline;

  const cbArea = li.querySelector(".checkbox");
  const xArea = li.querySelector(".x-area");
  const checkbox = li.querySelector("input[type='checkbox']");

  if (diff >= THRESHOLD_MS) {
    if (task.checked) {
      // ✅ completed → keep as is
      li.classList.remove("expired");
      cbArea.style.display = "flex";
      xArea.style.display = "none";
    } else {
      // ❌ expired + pending
      li.classList.add("expired");
      cbArea.style.display = "none";
      xArea.style.display = "flex";
    }
  } else {
    // still valid
    li.classList.remove("expired");
    cbArea.style.display = "flex";
    xArea.style.display = "none";
  }
}

// Auto refresh every minute
setInterval(renderHomeworks, 60*1000);
renderHomeworks();
</script>
</body>
</html>
